import{j as i}from"./jsx-runtime-I5Fx8Z9e.js";import{r as m}from"./iframe-3DMTuFmU.js";import{F as N}from"./FileUpload-PvineXmK.js";import{N as P}from"./NavSide-C90ODoCx.js";import{a as l}from"./api-DR_qaoiX.js";import{B as y}from"./Box-ecc2jeuf.js";import{T as u}from"./Typography-z9VRILUb.js";import{P as L}from"./Paper-CvWr1lkG.js";import{A as _}from"./Alert-rRLAgJoK.js";import{B as b}from"./Button-CPR_rcBR.js";import{u as k}from"./chunk-AYJ5UCUI-CUH48NyS.js";import"./AuthContext-CXKVu466.js";import"./createSvgIcon-BLDxFBmY.js";import"./clsx-B-dksMZM.js";import"./DefaultPropsProvider-Bcev3kPu.js";import"./createTheme-BEjq_8i9.js";import"./Close-DGlxePoy.js";import"./Description-CUYdnb3H.js";import"./index-xsH4HHeE.js";import"./extendSxProp-CQr8PZrt.js";import"./createSimplePaletteValueFilter-BeccQDja.js";import"./useTheme-CfKdnrro.js";import"./useSlot-BtR7VfLt.js";import"./CircularProgress-BPmC1gli.js";const O={async createApplication(t){try{return(await l.post("/document-applications",t)).data}catch(a){throw console.error("Error creating application:",a),a}},async getUserApplications(){try{return(await l.get("/document-applications")).data}catch(t){throw console.error("Error fetching applications:",t),t}},async getApplication(t){try{return(await l.get(`/document-applications/${t}`)).data}catch(a){throw console.error("Error fetching application:",a),a}},async updateApplication(t,a){try{return(await l.patch(`/document-applications/${t}`,a)).data}catch(p){throw console.error("Error updating application:",p),p}},async uploadFile(t,a,p){try{const n=new FormData;return n.append("file",a),n.append("documentCategory",p),(await l.post(`/document-applications/${t}/files`,n,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(n){throw console.error("Error uploading file:",n),n}},async getFileDownloadUrl(t){try{return(await l.get(`/document-applications/files/${t}/download`)).data.url}catch(a){throw console.error("Error getting file URL:",a),a}},async deleteApplication(t){try{return await l.delete(`/document-applications/${t}`),!0}catch(a){throw console.error("Error deleting application:",a),a}},async getAllApplications(){try{return(await l.get("/document-applications/admin/all")).data}catch(t){throw console.error("Error fetching all applications:",t),t}},async updateApplicationStatus(t,a,p){try{return(await l.patch(`/document-applications/${t}/status`,{status:a,statusMessage:p})).data}catch(n){throw console.error("Error updating application status:",n),n}},async getApplicationStats(){try{return(await l.get("/document-applications/admin/stats")).data}catch(t){throw console.error("Error fetching application stats:",t),t}}},w=()=>{const[t,a]=m.useState(!1),[p,n]=m.useState({}),[e,F]=m.useState({}),[U,S]=m.useState({}),[B,D]=m.useState(!1),I=k(),[z,J]=m.useState(!0),A=p["Valid ID"]===!0&&((e==null?void 0:e.purpose)!=="On behalf of someone"||p["Authorization Letter (if applicable)"]===!0);m.useEffect(()=>{try{const o=localStorage.getItem("birthCertificateApplication");o&&F(JSON.parse(o))}catch(o){console.error("Error loading form data:",o)}},[]);function R(o,c,s){try{const r=o.split(","),d=r[0].match(/:(.*?);/),C=d?d[1]:s,g=atob(r[1]);let f=g.length;const v=new Uint8Array(f);for(;f--;)v[f]=g.charCodeAt(f);return new File([v],c,{type:C})}catch(r){throw console.error("Error converting data URL to file:",r),new Error("Invalid file format")}}const x=async(o,c,s)=>{if(n(r=>({...r,[o]:c})),c&&s){S(r=>({...r,[o]:s}));try{const r=localStorage.getItem("currentApplicationId");if(!r){alert("Application ID is missing. Cannot upload file.");return}console.log("Application ID:",r),console.log("Uploading file:",s.name);const d=R(s.data,s.name,s.type),C=`/document-applications/${r}/files`;console.log("Uploading to URL:",C);const g=await O.uploadFile(r,d,o);console.log("Upload response:",g)}catch(r){console.error(`Failed to upload "${o}":`,r),r.response&&console.error("Server response:",r.response.status,r.response.data),alert(`Failed to upload "${o}": ${r.message}`)}}else S(r=>{const d={...r};return delete d[o],d})},$=()=>{if(A)try{const o=localStorage.getItem("currentApplicationId");if(!o){console.error("No application ID found"),alert("Application ID is missing. Cannot proceed.");return}const c={...e,uploadedFiles:U},s=JSON.parse(localStorage.getItem("applications")||"[]"),r=s.findIndex(d=>d.id===o);if(r>=0)s[r]={...s[r],formData:{...s[r].formData,...c},lastUpdated:new Date().toISOString()};else{console.error(`Application ID ${o} not found in applications array`),alert("Could not find your application. Please try again.");return}localStorage.setItem("applications",JSON.stringify(s)),localStorage.setItem("birthCertificateApplication",JSON.stringify(c)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new CustomEvent("customStorageUpdate",{detail:{id:o,action:"updated",type:"Birth Certificate"}})),D(!0),setTimeout(()=>{I("/BirthApplicationSummary")},2e3)}catch(o){console.error("Error submitting application:",o),alert("Error submitting application. Please try again.")}else alert("Please upload the required documents before submitting.")},q=()=>{I("/RequestACopyBirthCertificate")};return i.jsxs(y,{className:`MainContainerCTCBirth ${t?"SidebarOpenCTCBirth":""}`,children:[i.jsx(P,{isSidebarOpen:t,setIsSidebarOpen:a}),i.jsx(u,{variant:"h4",className:"TitleCTCBirth",children:"Upload Required Documents"}),i.jsx(u,{variant:"subtitle1",className:"SubtitleCTCBirth",children:"Please upload the following documents to complete your birth certificate copy request"}),i.jsxs(L,{elevation:3,className:"DocumentsPaperCTCBirth",children:[i.jsxs(y,{className:"ApplicantInfoCTCBirth",children:[i.jsx(u,{variant:"h6",children:"Applicant Information"}),i.jsxs(u,{variant:"body1",children:["Name: ",(e==null?void 0:e.firstName)||""," ",(e==null?void 0:e.middleName)||""," ",(e==null?void 0:e.lastName)||""]}),i.jsxs(u,{variant:"body1",children:["Date of Birth: ",(e==null?void 0:e.birthMonth)||""," ",(e==null?void 0:e.birthDay)||"",","," ",(e==null?void 0:e.birthYear)||""]}),i.jsxs(u,{variant:"body1",children:["Purpose: ",(e==null?void 0:e.purpose)||"Not specified"]})]}),i.jsx(u,{variant:"h6",className:"RequirementsHeaderCTCBirth",children:"Required Documents"}),i.jsxs(y,{className:"DocumentsListCTCBirth",children:[i.jsx(N,{label:"Valid ID",onUpload:(o,c)=>x("Valid ID",o,c),required:!0}),i.jsx(u,{variant:"caption",className:"DocumentDescriptionCTCBirth",children:"Please upload a clear copy of any valid government-issued ID (e.g., Driver's License, Passport, PhilSys ID)"}),i.jsx(N,{label:"Authorization Letter (if applicable)",onUpload:(o,c)=>x("Authorization Letter (if applicable)",o,c),required:!1}),i.jsx(u,{variant:"caption",className:"DocumentDescriptionCTCBirth",children:"If you are requesting on behalf of someone else, please upload a signed authorization letter and your valid ID"})]}),B&&i.jsx(_,{severity:"success",className:"SuccessAlertCTCBirth",children:"Your application has been submitted successfully! Redirecting to summary..."}),i.jsxs(y,{className:"ButtonContainerCTCBirth",children:[i.jsx(b,{variant:"outlined",color:"primary",onClick:q,className:"BackButtonCTCBirth",children:"Back"}),i.jsx(b,{variant:"contained",color:"primary",onClick:$,className:"SubmitButtonCTCBirth",disabled:!A||B,children:"Submit Application"})]})]})]})};w.__docgenInfo={description:"",methods:[],displayName:"CTCBirthCertificate"};const ht={title:"Components/CTCBirthcertificate",component:w},h=()=>i.jsx(w,{});h.__docgenInfo={description:"",methods:[],displayName:"Default"};var T,E,j;h.parameters={...h.parameters,docs:{...(T=h.parameters)==null?void 0:T.docs,source:{originalSource:"() => <CTCBirthcertificate />",...(j=(E=h.parameters)==null?void 0:E.docs)==null?void 0:j.source}}};const gt=["Default"];export{h as Default,gt as __namedExportsOrder,ht as default};
