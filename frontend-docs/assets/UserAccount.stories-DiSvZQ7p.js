import{j as e}from"./jsx-runtime-Ds-gkUgj.js";import{r}from"./index-CtvPRVHf.js";import{u as re}from"./AuthContext-DROsejNy.js";import{a as f}from"./index-xsH4HHeE.js";import{N as oe}from"./NavSide-CqY9HB19.js";import"./createSvgIcon-C90RuxAZ.js";import"./clsx-B-dksMZM.js";import"./DefaultPropsProvider-D010D3ru.js";import"./createTheme-C6kIcmbg.js";import"./Close-BFUA1JaJ.js";import"./Description-VtskB8YN.js";import"./chunk-AYJ5UCUI-CkRdRQ96.js";const U=()=>{const{user:ne,getCurrentUserId:Z}=re(),b=Z(),[A,v]=r.useState(""),[C,P]=r.useState(""),[g,S]=r.useState(""),[p,F]=r.useState(""),[D,E]=r.useState(""),[I,J]=r.useState(!1),[k,B]=r.useState(""),[l,G]=r.useState(""),[L,_]=r.useState(""),[$,x]=r.useState(""),[w,n]=r.useState({text:"",type:""}),[a,i]=r.useState({email:!1,phoneNumber:!1,password:!1,username:!1}),[O,M]=r.useState(null),[u,N]=r.useState(!0),[K,q]=r.useState(!0),[Q,y]=r.useState(!1),[X,j]=r.useState(null);r.useEffect(()=>{(async()=>{if(!b){q(!1);return}try{const t=localStorage.getItem("token"),o=(await f.get("http://localhost:3000/auth/profile",{headers:{Authorization:`Bearer ${t}`}})).data;v(o.firstName||""),P(o.lastName||""),S(o.username||""),F(o.email||""),E(o.phoneNumber||"");const d=localStorage.getItem("lastUsernameChange");d&&(M(new Date(d)),Y(new Date(d)))}catch(t){console.error("Error fetching user data:",t),n({text:"Failed to load user data. Please try again.",type:"error"})}finally{q(!1)}})()},[b]);const Y=s=>{if(!s){N(!0);return}const t=30*24*60*60*1e3,o=Date.now()-s.getTime()>t;N(o)},ee=async s=>{s.preventDefault(),n({text:"",type:""});const t={firstName:A,lastName:C};a.email||a.phoneNumber||a.username&&u?(a.email&&(t.email=p),a.phoneNumber&&(t.phoneNumber=D),a.username&&u&&(t.username=g),j(t),y(!0)):await z(t)},z=async s=>{var t,c;try{const o=localStorage.getItem("token");s.username&&u&&(localStorage.setItem("lastUsernameChange",new Date().toISOString()),M(new Date),N(!1)),await f.post("http://localhost:3000/auth/update-profile",s,{headers:{Authorization:`Bearer ${o}`}}),n({text:"Profile updated successfully",type:"success"}),i({email:!1,phoneNumber:!1,password:!1,username:!1}),y(!1),x(""),j(null)}catch(o){console.error("Error updating profile:",o),n({text:((c=(t=o.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to update profile",type:"error"})}},se=async s=>{s.preventDefault();try{console.log("Attempting to verify password");const t=await f.post("http://localhost:3000/auth/login",{email:p,emailOrUsername:p,username:g,password:$});console.log("Verification response received"),t.data&&t.data.access_token?(console.log("Password verification successful"),await z(X)):(console.log("Password verification failed - unexpected response format"),n({text:"Incorrect password. Please try again.",type:"error"}))}catch(t){console.error("Error verifying password:",t),t.response?(console.log("Error status:",t.response.status),console.log("Error data:",t.response.data),n({text:t.response.data.message||"Incorrect password. Please try again.",type:"error"})):n({text:"Failed to verify password. Please try again.",type:"error"})}},te=async s=>{var d,W;if(s.preventDefault(),n({text:"",type:""}),l!==L){n({text:"New passwords do not match",type:"error"});return}if(l.length<8){n({text:"New password must be at least 8 characters long",type:"error"});return}const t=/[A-Z]/.test(l),c=/[a-z]/.test(l),o=/\d/.test(l);if(!t||!c||!o){n({text:"Password must contain uppercase, lowercase, and numbers",type:"error"});return}try{const h=localStorage.getItem("token");await f.post("http://localhost:3000/auth/update-profile",{password:l,oldPassword:k},{headers:{Authorization:`Bearer ${h}`}}),n({text:"Password updated successfully",type:"success"}),B(""),G(""),_(""),i({...a,password:!1})}catch(h){console.error("Error changing password:",h),n({text:((W=(d=h.response)==null?void 0:d.data)==null?void 0:W.message)||"Failed to change password. Please check your current password.",type:"error"})}},ae=()=>{y(!1),x(""),j(null)},T=()=>{if(!O)return null;const s=30*24*60*60*1e3,t=new Date(O.getTime()+s),c=new Date;if(c>=t)return null;const o=t-c;return`${Math.floor(o/(24*60*60*1e3))} days`};return K?e.jsx("div",{className:"AccountLoaderUAcc",children:"Loading..."}):e.jsxs("div",{className:`AccountUAcc ${I?"sidebar-open":""}`,children:[e.jsx(oe,{isSidebarOpen:I,setIsSidebarOpen:J}),e.jsx("div",{className:"AccountHeaderUAcc",children:e.jsx("h1",{children:"User Account Settings"})}),e.jsxs("div",{className:"AccountContainerUAcc",children:[w.text&&e.jsx("div",{className:`MessageUAcc ${w.type}`,children:w.text}),Q&&e.jsx("div",{className:"PasswordConfirmationOverlayUAcc",children:e.jsxs("div",{className:"PasswordConfirmationDialogUAcc",children:[e.jsx("h3",{children:"Confirm Changes"}),e.jsx("p",{children:"Please enter your password to confirm these changes to your account."}),e.jsxs("form",{className:"DialogFormGroupUAcc",onSubmit:se,children:[e.jsxs("div",{className:"DialogFormGroupUAcc",children:[e.jsx("label",{className:"DialogLabel",htmlFor:"confirmationPassword",children:"Password*"}),e.jsx("input",{type:"password",id:"confirmationPassword",value:$,onChange:s=>x(s.target.value),autoFocus:!0,required:!0})]}),e.jsxs("div",{className:"DialogActionsUAcc",children:[e.jsx("button",{type:"button",className:"CancelButtonUAcc",onClick:ae,children:"Cancel"}),e.jsx("button",{type:"submit",className:"SaveButtonUAcc",children:"Confirm"})]})]})]})}),e.jsxs("form",{onSubmit:ee,className:"AccountFormUAcc",children:[e.jsxs("div",{className:"FormGroupUAcc",children:[e.jsx("label",{htmlFor:"firstName",children:"First name"}),e.jsx("input",{type:"text",id:"firstName",value:A,onChange:s=>v(s.target.value)})]}),e.jsxs("div",{className:"FormGroupUAcc",children:[e.jsx("label",{htmlFor:"lastName",children:"Last name"}),e.jsx("input",{type:"text",id:"lastName",value:C,onChange:s=>P(s.target.value)})]}),e.jsxs("div",{className:"FormGroupUAcc",children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsxs("div",{className:"InputWithActionUAcc",children:[e.jsx("input",{type:"text",id:"username",value:g,onChange:s=>S(s.target.value),disabled:!u||!a.username}),a.username?e.jsx("button",{type:"button",onClick:()=>i({...a,username:!1}),className:"CancelButtonUAcc",children:e.jsx("i",{className:"fas fa-times"})}):e.jsx("button",{type:"button",onClick:()=>i({...a,username:!0}),className:"EditButtonUAcc",disabled:!u,children:e.jsx("i",{className:"fas fa-pen"})})]}),!u&&e.jsxs("p",{className:"RestrictionNoteUAcc",children:["Username can only be changed once every 30 days.",T()&&` Time remaining: ${T()}`]})]}),e.jsxs("div",{className:"FormGroupUAcc",children:[e.jsx("label",{htmlFor:"email",children:"E-mail"}),e.jsxs("div",{className:"InputWithActionUAcc",children:[e.jsx("input",{type:"email",id:"email",value:p,onChange:s=>F(s.target.value),disabled:!a.email}),a.email?e.jsx("button",{type:"button",onClick:()=>i({...a,email:!1}),className:"CancelButtonUAcc",children:e.jsx("i",{className:"fas fa-times"})}):e.jsx("button",{type:"button",onClick:()=>i({...a,email:!0}),className:"EditButtonUAcc",children:e.jsx("i",{className:"fas fa-pen"})})]})]}),e.jsxs("div",{className:"FormGroupUAcc",children:[e.jsx("label",{htmlFor:"phoneNumber",children:"Phone number"}),e.jsxs("div",{className:"InputWithActionUAcc",children:[e.jsx("input",{type:"tel",id:"phoneNumber",value:D,onChange:s=>E(s.target.value),disabled:!a.phoneNumber}),a.phoneNumber?e.jsx("button",{type:"button",onClick:()=>i({...a,phoneNumber:!1}),className:"CancelButtonUAcc",children:e.jsx("i",{className:"fas fa-times"})}):e.jsx("button",{type:"button",onClick:()=>i({...a,phoneNumber:!0}),className:"EditButtonUAcc",children:e.jsx("i",{className:"fas fa-pen"})})]})]}),e.jsx("div",{className:"ActionsUAcc",children:e.jsx("button",{type:"submit",className:"SaveButtonUAcc",children:"Save Changes"})})]}),e.jsxs("div",{className:"PasswordSectionUAcc",children:[e.jsx("h2",{children:"Change Password"}),e.jsx("button",{type:"button",onClick:()=>i({...a,password:!a.password}),className:a.password?"CancelButtonUAcc":"ChangePasswordButtonUAcc",children:a.password?"Cancel":"Change Password"}),a.password&&e.jsxs("form",{onSubmit:te,className:"PasswordFormUAcc",children:[e.jsxs("div",{className:"FormGroupUAcc",children:[e.jsx("label",{htmlFor:"currentPassword",children:"Current Password*"}),e.jsx("input",{type:"password",id:"currentPassword",value:k,onChange:s=>B(s.target.value),required:!0})]}),e.jsxs("div",{className:"FormGroupUAcc",children:[e.jsx("label",{htmlFor:"newPassword",children:"New Password*"}),e.jsx("input",{type:"password",id:"newPassword",value:l,onChange:s=>G(s.target.value),required:!0})]}),e.jsxs("div",{className:"FormGroupUAcc",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"Confirm New Password*"}),e.jsx("input",{type:"password",id:"confirmPassword",value:L,onChange:s=>_(s.target.value),required:!0})]}),e.jsx("div",{className:"ActionsUAcc",children:e.jsx("button",{type:"submit",className:"SaveButtonUAcc",children:"Update Password"})})]})]})]})]})};U.__docgenInfo={description:"",methods:[],displayName:"UserAccount"};const Ne={title:"Components/UserAccount",component:U},m=()=>e.jsx(U,{});m.__docgenInfo={description:"",methods:[],displayName:"Default"};var R,H,V;m.parameters={...m.parameters,docs:{...(R=m.parameters)==null?void 0:R.docs,source:{originalSource:"() => <UserAccount />",...(V=(H=m.parameters)==null?void 0:H.docs)==null?void 0:V.source}}};const ye=["Default"];export{m as Default,ye as __namedExportsOrder,Ne as default};
