import{j as e}from"./jsx-runtime-Ds-gkUgj.js";import{r as d}from"./index-CtvPRVHf.js";import{q as k}from"./queueService-BrJ6LFgm.js";import{a as w}from"./api-D_0F9__f.js";import{L as S}from"./chunk-AYJ5UCUI-CkRdRQ96.js";const C=i=>{if(typeof i=="string"&&i.startsWith("WK"))return i;if(!i)return"WK000";const p=i!=null&&i.includes("-")?i.split("-")[1]:i,c=parseInt(p,10)||0;return`WK${String(c).padStart(3,"0")}`},P=()=>{const[i,p]=d.useState([]),[c,x]=d.useState([]),[v,b]=d.useState(!0),[f,q]=d.useState(null),[j,y]=d.useState(!1),[u,W]=d.useState(null),m=d.useCallback(async()=>{b(!0);try{const[s,n]=await Promise.all([k.fetchPendingQueuesWithDetails(),k.fetchCurrentQueuesWithDetails()]);console.log("Queue data fetched:",s,n);const r=s.map(l=>{const t=l.queue||{},o=l.details||{},h=o.user||{};return{id:t.id||l.id,queueNumber:C(t.queueNumber||t.id),firstName:o.firstName||h.firstName||t.firstName||"Guest",lastName:o.lastName||h.lastName||t.lastName||"",reasonOfVisit:o.reasonOfVisit||t.reason||t.reasonOfVisit||"General Inquiry",status:t.status||"pending",timestamp:t.createdAt||t.date||new Date().toISOString()}}),a=n.map(l=>{const t=l.queue||{},o=l.details||{},h=o.user||{};return{id:t.id||l.id,queueNumber:C(t.queueNumber||t.id),firstName:o.firstName||h.firstName||t.firstName||"Guest",lastName:o.lastName||h.lastName||t.lastName||"",reasonOfVisit:o.reasonOfVisit||t.reason||t.reasonOfVisit||"General Inquiry",status:t.status||"in-progress",timestamp:t.createdAt||t.date||new Date().toISOString()}});p(r),x(a),q(null)}catch(s){console.error("Error fetching queue data:",s),q("Could not load queue data. Please ensure the server is running.")}finally{b(!1)}},[]),Q=async(s,n)=>{try{if(await w.patch(`http://localhost:3000/queue/${s}/status`,{status:n}),n==="in-progress"){const r=i.find(a=>a.id===s);r&&(p(a=>a.filter(l=>l.id!==s)),x(a=>[...a,{...r,status:"in-progress"}]))}else if(n==="completed")x(r=>r.filter(a=>a.id!==s));else if(n==="pending"){const r=c.find(a=>a.id===s);r&&(x(a=>a.filter(l=>l.id!==s)),p(a=>[...a,{...r,status:"pending"}]))}console.log(`Queue ${s} updated to ${n}`),m()}catch(r){console.error("Failed to update queue status:",r),alert("Failed to update queue status. Please try again.")}},g=()=>[...i,...c].sort((n,r)=>{const a=parseInt(n.queueNumber.replace("WK",""),10),l=parseInt(r.queueNumber.replace("WK",""),10);return a-l});d.useEffect(()=>{m();const s=setInterval(m,3e4);return()=>clearInterval(s)},[m]);const N=async s=>{try{const n=await w.get(`http://localhost:3000${s}`);alert(`Response from ${s}:
${JSON.stringify(n.data,null,2).slice(0,300)}...`),console.log(`Full response from ${s}:`,n.data)}catch(n){alert(`Error testing ${s}: ${n.message}`),console.error(`Error testing ${s}:`,n)}};return e.jsxs("div",{className:"admin-walk-in-queue",children:[!v&&!f&&(i.length>0||c.length>0)&&e.jsxs("div",{className:"queue-stats",children:[e.jsxs("div",{className:"queue-stat",children:[e.jsx("span",{className:"queue-stat-value",children:i.length+c.length}),e.jsx("span",{className:"queue-stat-label",children:"Total"})]}),e.jsxs("div",{className:"queue-stat",children:[e.jsx("span",{className:"queue-stat-value",children:i.length}),e.jsx("span",{className:"queue-stat-label",children:"Waiting"})]}),e.jsxs("div",{className:"queue-stat",children:[e.jsx("span",{className:"queue-stat-value",children:c.length}),e.jsx("span",{className:"queue-stat-label",children:"In Progress"})]})]}),e.jsxs("div",{className:"queue-content",children:[v?e.jsxs("div",{className:"queue-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading queue data..."})]}):f?e.jsxs("div",{className:"queue-error",children:[e.jsx("p",{children:f}),e.jsx("button",{onClick:m,className:"retry-btn",style:{padding:"8px 16px",background:"#1C4D5A",color:"white",border:"none",borderRadius:"4px",marginTop:"10px",cursor:"pointer"},children:"Retry"})]}):g().length===0?e.jsxs("div",{className:"queue-empty",children:[e.jsx("p",{children:"No active walk-in queue"}),e.jsx("small",{children:"When citizens create walk-in appointments, they'll appear here."})]}):e.jsxs("div",{className:"queue-list",children:[g().slice(0,5).map(s=>e.jsxs("div",{className:`queue-item ${s.status==="in-progress"?"active-queue":""}`,children:[e.jsxs("div",{className:"queue-top",children:[e.jsx("div",{className:"queue-number",children:s.queueNumber}),e.jsx("div",{className:`queue-status ${s.status}`,children:s.status})]}),e.jsxs("div",{className:"queue-details",children:[e.jsx("div",{className:"queue-name",children:`${s.firstName} ${s.lastName}`}),e.jsx("div",{className:"queue-reason",children:s.reasonOfVisit}),e.jsx("div",{className:"queue-time",children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"queue-actions",children:[s.status==="pending"&&e.jsx("button",{className:"queue-action-btn start",onClick:()=>Q(s.id,"in-progress"),"aria-label":"Start serving this client",children:"Start"}),s.status==="in-progress"&&e.jsx("button",{className:"queue-action-btn complete",onClick:()=>Q(s.id,"completed"),"aria-label":"Mark this appointment as completed",children:"Complete"})]})]},s.id)),g().length>5&&e.jsx("div",{className:"queue-more-info",children:e.jsxs("p",{children:["+ ",g().length-5," more queued visitors"]})})]}),e.jsx("div",{className:"queue-footer",children:e.jsx(S,{to:"/AdminWalkInQueue",className:"view-all-btn",children:"View All Queues"})})]}),j&&e.jsxs("div",{style:{position:"fixed",bottom:"20px",right:"20px",background:"white",border:"1px solid #ddd",padding:"15px",borderRadius:"5px",boxShadow:"0 0 10px rgba(0,0,0,0.1)",zIndex:9999,maxWidth:"400px",maxHeight:"80vh",overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:"0 0 10px"},children:"API Response Debug"}),e.jsx("button",{onClick:()=>y(!1),children:"Close"})]}),u?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Queue Count:"})," ",u.queueCount||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Queue Properties:"})," ",u.dataStructure||"No data"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Test API Endpoints:"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px",margin:"5px 0"},children:[e.jsx("button",{onClick:()=>N("/queue/pending"),children:"Test /queue/pending"}),e.jsx("button",{onClick:()=>N("/queue/pending/details"),children:"Test /queue/pending/details"}),u.rawPendingQueue&&u.rawPendingQueue.id&&e.jsxs("button",{onClick:()=>N(`/queue/${u.rawPendingQueue.id}/details`),children:["Test /queue/",u.rawPendingQueue.id,"/details"]})]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Raw Queue Data:"})}),e.jsx("pre",{style:{background:"#f5f5f5",padding:"10px",overflow:"auto",fontSize:"12px"},children:JSON.stringify(u.rawPendingQueue,null,2)})]}):e.jsx("p",{children:"No queue data available for debugging"})]}),e.jsx("button",{onClick:()=>y(!j),style:{position:"fixed",bottom:"10px",right:"10px",padding:"5px 10px",background:"#f0f0f0",border:"1px solid #ccc",borderRadius:"4px",opacity:j?0:.7,zIndex:9990},children:"Debug"})]})};P.__docgenInfo={description:"",methods:[],displayName:"WalkInQueueAdmin"};export{P as W};
