import{j as e}from"./jsx-runtime-Ds-gkUgj.js";import{r}from"./index-CtvPRVHf.js";import{C as W}from"./Calendar-Ccdq6xBc.js";import{s as k}from"./RecentAppointmentData-yblrwM7G.js";import{a as y}from"./appointmentService-Cr9JVgLu.js";import{u as V}from"./chunk-AYJ5UCUI-CkRdRQ96.js";const _=({onBack:x,preselectedDate:u})=>{const E=V(),[f,F]=r.useState(!0),[w,O]=r.useState(null),[g,j]=r.useState(!1),[h,q]=r.useState({lastName:"Francisco",firstName:"Luan",middleInitial:"D",address:"123 Main St, Evetywhere, Bulacan",phoneNumber:"09124458403"}),[t,d]=r.useState({lastName:"",firstName:"",middleInitial:"",address:"",phoneNumber:"",reason:"",date:"",time:""}),[n,M]=r.useState({}),[o,b]=r.useState(u),[B,S]=r.useState(!1),[v,C]=r.useState([]),[N,I]=r.useState(!1),D=a=>{O(a),F(!1),a&&d({...t,lastName:h.lastName,firstName:h.firstName,middleInitial:h.middleInitial,address:h.address,phoneNumber:h.phoneNumber})};r.useEffect(()=>{u&&(b(u),d({...t,date:u.toLocaleDateString()}))},[u]),r.useEffect(()=>{o&&$()},[o]);const $=async()=>{try{I(!0);const a=o.toISOString().split("T")[0],s=await y.fetchAvailableSlots(a);C(s)}catch(a){console.error("Error fetching available slots:",a),C(T())}finally{I(!1)}},T=()=>{const a=[];let s=8,m=0;for(;s<17;){let i=`${s}:${m===0?"00":"30"} ${s<12?"AM":"PM"}`;m+=30,m===60&&(m=0,s+=1);let c=`${s}:${m===0?"00":"30"} ${s<12?"AM":"PM"}`;a.push(`${i} - ${c}`)}return a},R=v.length>0?v:T(),p=a=>{d({...t,[a.target.name]:a.target.value})},G=a=>{const s=a.target.value;/^\d*$/.test(s)&&s.length<=11&&d({...t,phoneNumber:s})},L=a=>{a.getDay()===0||a.getDay()===6?S(!0):(S(!1),b(a),d({...t,date:a.toLocaleDateString()}))},P=async()=>{var s,m;let a={};if(Object.keys(t).forEach(i=>{t[i]||(a[i]="This field is required.")}),Object.keys(a).length>0){M(a);return}try{j(!0);const i=`APPT-${Date.now()}`,c={firstName:t.firstName,lastName:t.lastName,middleInitial:t.middleInitial||"",address:t.address,phoneNumber:t.phoneNumber,reasonOfVisit:t.reason,appointmentDate:o.toISOString().split("T")[0],appointmentTime:t.time,isGuest:!w};console.log("Submitting real appointment data to backend:",c);const l=await y.createAppointment(c);console.log("Real appointment created successfully:",l);const A={id:l.appointmentNumber||i,appointmentNumber:l.appointmentNumber,type:t.reason,date:o.toISOString().split("T")[0],time:t.time,lastName:t.lastName,firstName:t.firstName,middleInitial:t.middleInitial,address:t.address,phoneNumber:t.phoneNumber,reasonOfVisit:t.reason,appointmentDate:o.toISOString().split("T")[0],appointmentTime:t.time,status:l.status||"pending",dbId:l.id,createdAt:l.createdAt,updatedAt:l.updatedAt};k(A),alert("Appointment Confirmed!"),E(`/QRCodeAppointment/${l.appointmentNumber||i}`,{state:{appointment:{...A,id:l.id,appointmentNumber:l.appointmentNumber,status:l.status}}}),d({lastName:"",firstName:"",middleInitial:"",address:"",phoneNumber:"",reason:"",date:"",time:""})}catch(i){console.error("Error creating real appointment:",i);let c="Failed to create appointment. Please try again.";(m=(s=i.response)==null?void 0:s.data)!=null&&m.message?c=i.response.data.message:i.message&&(c=i.message),alert(c)}finally{j(!1)}};return e.jsxs("div",{className:"AppointmentFormsContainer",children:[f&&e.jsx("div",{className:"DialogOverlay",children:e.jsxs("div",{className:"DialogBox",children:[x&&e.jsx("button",{className:"DialogBackButton",onClick:x,children:"X"}),e.jsx("h3",{className:"DialogText",children:"Who is this appointment for?"}),e.jsxs("div",{className:"DialogButtons",children:[e.jsx("button",{className:"DialogButton SelfButton",onClick:()=>D(!0),children:"For Myself"}),e.jsx("button",{className:"DialogButton OtherButton",onClick:()=>D(!1),children:"For Someone Else"})]})]})}),!f&&e.jsxs("div",{className:"AppointmentFContainer",children:[e.jsx("h2",{className:"AppointmentTitle",children:"APPOINTMENT FORM"}),e.jsxs("div",{className:"FormGroup RowGroup",children:[e.jsxs("div",{className:"InputWrapper",children:[e.jsx("label",{children:"Last Name"}),e.jsx("input",{type:"text",name:"lastName",value:t.lastName,onChange:p}),n.lastName&&e.jsx("span",{className:"ErrorText",children:n.lastName})]}),e.jsxs("div",{className:"InputWrapper",children:[e.jsx("label",{children:"First Name"}),e.jsx("input",{type:"text",name:"firstName",value:t.firstName,onChange:p}),n.firstName&&e.jsx("span",{className:"ErrorText",children:n.firstName})]}),e.jsxs("div",{className:"InputWrapper SmallInput",children:[e.jsx("label",{children:"Middle Initial"}),e.jsx("input",{type:"text",name:"middleInitial",value:t.middleInitial,onChange:p})]})]}),e.jsxs("div",{className:"FormGroup RowGroup",children:[e.jsxs("div",{className:"InputWrapper LargeInput",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",name:"address",value:t.address,onChange:p}),n.address&&e.jsx("span",{className:"ErrorText",children:n.address})]}),e.jsxs("div",{className:"InputWrapper",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"text",name:"phoneNumber",value:t.phoneNumber,onChange:G,maxLength:"11"}),n.phoneNumber&&e.jsx("span",{className:"ErrorText",children:n.phoneNumber})]})]}),e.jsxs("div",{className:"FormGroup SlotGroup",children:[e.jsxs("div",{className:"InputWrapper AppointTime",children:[e.jsx("label",{children:"Reason for Visit"}),e.jsxs("select",{name:"reason",value:t.reason,onChange:p,children:[e.jsx("option",{value:"",children:"Select a Reason"}),e.jsx("option",{value:"Birth Certificate",children:"Birth Certificate"}),e.jsx("option",{value:"Marriage Certificate",children:"Marriage Certificate"}),e.jsx("option",{value:"Death Certificate",children:"Death Certificate"})]}),n.reason&&e.jsx("span",{className:"ErrorText",children:n.reason})]}),e.jsxs("div",{className:"InputWrapper AppointTime",children:[e.jsx("label",{className:"AppointTimeSelected",children:"Select Time"}),e.jsxs("select",{name:"time",value:t.time,onChange:p,disabled:N,children:[e.jsx("option",{value:"",children:N?"Loading available times...":"Select a Time Slot"}),R.map((a,s)=>e.jsx("option",{value:a,children:a},s))]}),n.time&&e.jsx("span",{className:"ErrorText",children:n.time}),N&&e.jsx("span",{className:"InfoText",children:"Fetching real-time availability..."})]})]}),e.jsxs("div",{className:"FormGroup RowGroup",children:[e.jsxs("div",{className:"InputWrapper",children:[e.jsx("label",{children:"Select Date of Visit"}),e.jsx(W,{className:"Calendar",onChange:L,value:o,tileDisabled:({date:a})=>a.getDay()===0||a.getDay()===6||a<new Date}),n.date&&e.jsx("span",{className:"ErrorText",children:n.date}),B&&e.jsx("span",{className:"ErrorText",children:"Office is closed on weekends."}),o&&e.jsxs("div",{className:"SelectedDateInfo",children:["Selected: ",o.toLocaleDateString()]})]}),e.jsx("div",{className:"ConfirmContainer",children:e.jsx("button",{className:"ConfirmButton",onClick:P,disabled:g||N,children:g?"Creating Appointment...":"Confirm"})})]})]})]})};_.__docgenInfo={description:"",methods:[],displayName:"AppointmentContainer"};export{_ as A};
