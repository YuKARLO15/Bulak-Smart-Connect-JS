import{j as o}from"./jsx-runtime-BQ3NsQ6b.js";import{r as l}from"./iframe-DlZyR-3o.js";import{F as N}from"./FileUpload-BFB1PG5u.js";import{N as $}from"./NavSide-C5d_DcLL.js";import{d as A}from"./documentApplicationService-CnduSjML.js";import{B as m}from"./Box-kW_oYhdJ.js";import{T as n}from"./Typography-zMzzW-gN.js";import{P as L}from"./Paper-CQ3AIqLg.js";import{A as k}from"./Alert-DyFyAaah.js";import{B as T}from"./Button-KDMn5JJ-.js";import{u as _}from"./chunk-AYJ5UCUI-CYK0uUV1.js";import"./AuthContext-sjaEVyQP.js";import"./createSvgIcon-B1mfXgi4.js";import"./clsx-B-dksMZM.js";import"./DefaultPropsProvider-Cqs54V2y.js";import"./identifier-B6pg45cx.js";import"./Close-101PcF4a.js";import"./Description-VAgdDaQB.js";import"./Campaign-xUSs3NLA.js";import"./api-DR_qaoiX.js";import"./index-xsH4HHeE.js";import"./useTheme-CnXjXBB5.js";import"./createSimplePaletteValueFilter-D9fbgT6T.js";import"./useTheme-C_z8Hb-H.js";import"./useSlot-DRlPGcg5.js";import"./CircularProgress-Z1EmvMCU.js";import"./IconButton-ClkVjmik.js";const h=()=>{const[f,U]=l.useState(!1),[C,g]=l.useState({}),[t,D]=l.useState({}),[E,S]=l.useState({}),[y,B]=l.useState(!1),I=_(),[O,M]=l.useState(!0),b=C["Valid ID"]===!0&&((t==null?void 0:t.purpose)!=="On behalf of someone"||C["Authorization Letter (if applicable)"]===!0);l.useEffect(()=>{try{const e=localStorage.getItem("birthCertificateApplication");e&&D(JSON.parse(e))}catch(e){console.error("Error loading form data:",e)}},[]);function q(e,s,r){try{const a=e.split(","),i=a[0].match(/:(.*?);/),c=i?i[1]:r,u=atob(a[1]);let p=u.length;const v=new Uint8Array(p);for(;p--;)v[p]=u.charCodeAt(p);return new File([v],s,{type:c})}catch(a){throw console.error("Error converting data URL to file:",a),new Error("Invalid file format")}}const x=async(e,s,r)=>{var a;if(g(i=>({...i,[e]:s})),s&&r){S(i=>({...i,[e]:r}));try{const i=localStorage.getItem("currentApplicationId");if(!i){alert("Application ID is missing. Cannot upload file.");return}console.log("Application ID:",i),console.log("Uploading file:",r.name);const c=q(r.data,r.name,r.type),u=`/document-applications/${i}/files`;console.log("Uploading to URL:",u);const p=await A.uploadFile(i,c,e);console.log("Upload response:",p),alert(`"${e}" uploaded successfully!`)}catch(i){console.error(`Failed to upload "${e}":`,i),i.response?(console.error("Server response:",i.response.status,i.response.data),alert(`Failed to upload "${e}": ${((a=i.response.data)==null?void 0:a.message)||i.message}`)):alert(`Failed to upload "${e}": ${i.message}`),g(c=>({...c,[e]:!1}))}}else S(i=>{const c={...i};return delete c[e],c})},R=async()=>{if(!b){alert("Please upload the required documents before submitting.");return}try{B(!0);const e=localStorage.getItem("currentApplicationId");if(!e){console.error("No application ID found"),alert("Application ID is missing. Cannot proceed.");return}try{await A.updateApplication(e,{status:"SUBMITTED",statusMessage:"Application submitted with all required documents"}),console.log("Application status updated in backend")}catch(i){console.error("Failed to update backend status:",i)}const s={...t,uploadedFiles:E,status:"Submitted",submittedAt:new Date().toISOString()},r=JSON.parse(localStorage.getItem("applications")||"[]"),a=r.findIndex(i=>i.id===e);if(a>=0)r[a]={...r[a],formData:{...r[a].formData,...s},status:"Submitted",lastUpdated:new Date().toISOString()};else{console.error(`Application ID ${e} not found in applications array`),alert("Could not find your application. Please try again.");return}localStorage.setItem("applications",JSON.stringify(r)),localStorage.setItem("birthCertificateApplication",JSON.stringify(s)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new CustomEvent("customStorageUpdate",{detail:{id:e,action:"updated",type:"Birth Certificate"}})),console.log("Application submitted successfully"),setTimeout(()=>{I("/BirthApplicationSummary")},2e3)}catch(e){console.error("Error submitting application:",e),alert(`Error submitting application: ${e.message}`),B(!1)}},P=()=>{I("/RequestACopyBirthCertificate")};return o.jsxs(m,{className:`MainContainerCTCBirth ${f?"SidebarOpenCTCBirth":""}`,children:[o.jsx($,{isSidebarOpen:f,setIsSidebarOpen:U}),o.jsx(n,{variant:"h4",className:"TitleCTCBirth",children:"Upload Required Documents"}),o.jsx(n,{variant:"subtitle1",className:"SubtitleCTCBirth",children:"Please upload the following documents to complete your birth certificate copy request"}),o.jsxs(L,{elevation:3,className:"DocumentsPaperCTCBirth",children:[o.jsxs(m,{className:"ApplicantInfoCTCBirth",children:[o.jsx(n,{variant:"h6",children:"Applicant Information"}),o.jsxs(n,{variant:"body1",children:["Name: ",(t==null?void 0:t.firstName)||""," ",(t==null?void 0:t.middleName)||""," ",(t==null?void 0:t.lastName)||""]}),o.jsxs(n,{variant:"body1",children:["Date of Birth: ",(t==null?void 0:t.birthMonth)||""," ",(t==null?void 0:t.birthDay)||"",","," ",(t==null?void 0:t.birthYear)||""]}),o.jsxs(n,{variant:"body1",children:["Purpose: ",(t==null?void 0:t.purpose)||"Not specified"]})]}),o.jsx(n,{variant:"h6",className:"RequirementsHeaderCTCBirth",children:"Required Documents"}),o.jsxs(m,{className:"DocumentsListCTCBirth",children:[o.jsx(N,{label:"Valid ID",onUpload:(e,s)=>x("Valid ID",e,s),required:!0}),o.jsx(n,{variant:"caption",className:"DocumentDescriptionCTCBirth",children:"Please upload a clear copy of any valid government-issued ID (e.g., Driver's License, Passport, PhilSys ID)"}),o.jsx(N,{label:"Authorization Letter (if applicable)",onUpload:(e,s)=>x("Authorization Letter (if applicable)",e,s),required:!1}),o.jsx(n,{variant:"caption",className:"DocumentDescriptionCTCBirth",children:"If you are requesting on behalf of someone else, please upload a signed authorization letter and your valid ID"})]}),y&&o.jsx(k,{severity:"success",className:"SuccessAlertCTCBirth",children:"Your application has been submitted successfully! Redirecting to summary..."}),o.jsxs(m,{className:"ButtonContainerCTCBirth",children:[o.jsx(T,{variant:"outlined",color:"primary",onClick:P,className:"BackButtonCTCBirth",children:"Back"}),o.jsx(T,{variant:"contained",color:"primary",onClick:R,className:"SubmitButtonCTCBirth",disabled:!b||y,children:"Submit Application"})]})]})]})};h.__docgenInfo={description:"",methods:[],displayName:"CTCBirthCertificate"};const Ce={title:"Components/CTCBirthcertificate",component:h},d=()=>o.jsx(h,{});d.__docgenInfo={description:"",methods:[],displayName:"Default"};var w,j,F;d.parameters={...d.parameters,docs:{...(w=d.parameters)==null?void 0:w.docs,source:{originalSource:"() => <CTCBirthcertificate />",...(F=(j=d.parameters)==null?void 0:j.docs)==null?void 0:F.source}}};const ge=["Default"];export{d as Default,ge as __namedExportsOrder,Ce as default};
