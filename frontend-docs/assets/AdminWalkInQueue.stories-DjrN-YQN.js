import{j as e}from"./jsx-runtime-Ds-gkUgj.js";import{r as l}from"./index-CtvPRVHf.js";import{N as K}from"./NavSide-SprS5l14.js";import{q as j}from"./queueService-Krhbga47.js";import{u as B}from"./chunk-AYJ5UCUI-CkRdRQ96.js";import"./AuthContext-DROsejNy.js";import"./createSvgIcon-C90RuxAZ.js";import"./clsx-B-dksMZM.js";import"./DefaultPropsProvider-D010D3ru.js";import"./createTheme-C6kIcmbg.js";import"./Close-BFUA1JaJ.js";import"./Description-VtskB8YN.js";import"./api-D_0F9__f.js";const h=i=>{if(typeof i=="string"&&i.startsWith("WK"))return i;if(!i)return"WK000";const f=i!=null&&i.includes("-")?i.split("-")[1]:i,x=parseInt(f,10)||0;return`WK${String(x).padStart(3,"0")}`},w=()=>{const[i,f]=l.useState(!1),[x,P]=l.useState(!1),[c,C]=l.useState([]),[u,_]=l.useState([]),[$,v]=l.useState(!0),[Q,I]=l.useState(null),G=B(),R=u.length>0?h(u[0].queueNumber||u[0].id):"None",U=c.length>0?h(c[0].queueNumber||c[0].id):"None",L=c.length+u.length,g=l.useCallback(async()=>{v(!0);try{const[s,k]=await Promise.all([j.fetchPendingQueues(),j.fetchCurrentQueues()]),d=s.map(a=>{const n=a.userData||a.details||a.user||{};return{id:a.id,queueNumber:h(a.queueNumber||a.id),firstName:n.firstName||a.firstName||"Guest",lastName:n.lastName||a.lastName||"",reasonOfVisit:n.reasonOfVisit||a.reasonOfVisit||"General Inquiry",status:"pending",timestamp:a.createdAt||new Date().toISOString()}}),m=k.map(a=>{const n=a.userData||a.details||a.user||{};return{id:a.id,queueNumber:h(a.queueNumber||a.id),firstName:n.firstName||a.firstName||"Guest",lastName:n.lastName||a.lastName||"",reasonOfVisit:n.reasonOfVisit||a.reasonOfVisit||"General Inquiry",status:"serving",timestamp:a.createdAt||new Date().toISOString()}});if(s.length>0||k.length>0)try{const n=[...s,...k].map(p=>j.fetchQueueDetails(p.id).then(t=>{var y,S,D,E,b,W;const o=d.findIndex(r=>r.id===p.id);if(o!==-1)d[o]={...d[o],firstName:((y=t.details)==null?void 0:y.firstName)||d[o].firstName,lastName:((S=t.details)==null?void 0:S.lastName)||d[o].lastName,reasonOfVisit:((D=t.details)==null?void 0:D.reasonOfVisit)||d[o].reasonOfVisit};else{const r=m.findIndex(T=>T.id===p.id);r!==-1&&(m[r]={...m[r],firstName:((E=t.details)==null?void 0:E.firstName)||m[r].firstName,lastName:((b=t.details)==null?void 0:b.lastName)||m[r].lastName,reasonOfVisit:((W=t.details)==null?void 0:W.reasonOfVisit)||m[r].reasonOfVisit})}return t}).catch(t=>(console.error(`Error fetching details for queue ${p.id}:`,t),null)));await Promise.all(n)}catch(a){console.error("Error fetching queue details:",a)}C(d),_(m),I(null)}catch(s){console.error("Error fetching queue data:",s),I("Failed to load queue data. Please ensure the server is running.")}finally{v(!1)}},[]),O=s=>{G(`/AdminWalkInDetails/${s}`)};return l.useEffect(()=>{g();const s=setInterval(g,3e4);return()=>clearInterval(s)},[g]),e.jsxs("div",{className:"admin-walkin-queue",children:[e.jsxs("div",{className:"admin-walkin-queue-header-bar",children:[e.jsx("button",{className:"admin-walkin-queue-menu-btn",onClick:()=>f(!0),"aria-label":"Open navigation",children:e.jsxs("span",{className:"admin-walkin-queue-menu-icon",children:[e.jsx("span",{className:"admin-walkin-queue-menu-bar"}),e.jsx("span",{className:"admin-walkin-queue-menu-bar"}),e.jsx("span",{className:"admin-walkin-queue-menu-bar"})]})}),e.jsx("h1",{className:"admin-walkin-queue-header-title",children:"Walk - in"})]}),e.jsx(K,{isSidebarOpen:x,setIsSidebarOpen:P}),e.jsxs("div",{className:"admin-walkin-queue-main",children:[e.jsxs("div",{className:"admin-walkin-queue-summary-row",children:[e.jsxs("div",{className:"admin-walkin-queue-summary-card",children:[e.jsx("h2",{className:"admin-walkin-queue-summary-title",children:"CURRENT QUEUE"}),e.jsx("div",{className:"admin-walkin-queue-summary-number",children:R}),e.jsxs("div",{className:"admin-walkin-queue-summary-next",children:["Next on Queue ",e.jsx("span",{className:"admin-walkin-queue-summary-next-number",children:U})]})]}),e.jsxs("div",{className:"admin-walkin-queue-summary-card gray",children:[e.jsx("h2",{className:"admin-walkin-queue-summary-title",children:"TOTAL NUMBER OF QUEUE"}),e.jsx("div",{className:"admin-walkin-queue-summary-number",children:L})]})]}),e.jsxs("div",{className:"admin-walkin-queue-list-section",children:[e.jsx("h2",{className:"admin-walkin-queue-list-title",children:"Walk - In Queues"}),$?e.jsxs("div",{style:{textAlign:"center",padding:"20px"},children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading queue data..."})]}):Q?e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#721c24"},children:e.jsx("p",{children:Q})}):c.length===0&&u.length===0?e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666"},children:e.jsx("p",{children:"No active walk-in queues"})}):e.jsxs("div",{className:"admin-walkin-queue-list",children:[u.map(s=>e.jsxs("div",{className:"admin-walkin-queue-item active-queue",onClick:()=>O(s.id),children:[e.jsxs("div",{className:"admin-walkin-queue-status-section",children:[e.jsx("div",{className:"admin-walkin-queue-status",children:"IN PROGRESS"}),e.jsx("div",{className:"admin-walkin-queue-date",children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"admin-walkin-queue-applicant",children:`${s.firstName} ${s.lastName}`}),e.jsx("div",{className:"admin-walkin-queue-id",children:s.queueNumber})]},s.id)),c.map(s=>e.jsxs("div",{className:"admin-walkin-queue-item",onClick:()=>O(s.id),children:[e.jsxs("div",{className:"admin-walkin-queue-status-section",children:[e.jsx("div",{className:"admin-walkin-queue-status",children:"PENDING"}),e.jsx("div",{className:"admin-walkin-queue-date",children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"admin-walkin-queue-applicant",children:`${s.firstName} ${s.lastName}`}),e.jsx("div",{className:"admin-walkin-queue-id",children:s.queueNumber})]},s.id))]})]})]})]})};w.__docgenInfo={description:"",methods:[],displayName:"AdminWalkInQueue"};const te={title:"Components/AdminWalkInQueue",component:w},N=()=>e.jsx(w,{});N.__docgenInfo={description:"",methods:[],displayName:"Default"};var q,A,V;N.parameters={...N.parameters,docs:{...(q=N.parameters)==null?void 0:q.docs,source:{originalSource:"() => <AdminWalkInQueue />",...(V=(A=N.parameters)==null?void 0:A.docs)==null?void 0:V.source}}};const re=["Default"];export{N as Default,re as __namedExportsOrder,te as default};
