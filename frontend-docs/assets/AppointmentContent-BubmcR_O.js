import{j as e}from"./jsx-runtime-I5Fx8Z9e.js";import{r as l}from"./iframe-3DMTuFmU.js";import{C as U}from"./Calendar-CqOooZrb.js";import{s as V}from"./RecentAppointmentData-yblrwM7G.js";import{a as y}from"./appointmentService-Cr9JVgLu.js";import{a as _}from"./index-xsH4HHeE.js";import{u as q}from"./chunk-AYJ5UCUI-CUH48NyS.js";const z=({onBack:f,preselectedDate:E})=>{const F=q(),[g,w]=l.useState(!0),[O,$]=l.useState(null),[x,j]=l.useState(!1),[b,S]=l.useState(!1),[c,B]=l.useState({lastName:"",firstName:"",middleInitial:"",address:"",phoneNumber:""}),[a,p]=l.useState({lastName:"",firstName:"",middleInitial:"",address:"",phoneNumber:"",reason:"",date:"",time:""}),[i,u]=l.useState({}),[m,M]=l.useState(E||new Date),[k,v]=l.useState(!1),[D,I]=l.useState([]),[h,C]=l.useState(!1);l.useEffect(()=>{(async()=>{try{S(!0);const s=localStorage.getItem("token");if(!s){console.log("No token found, user might not be logged in");return}const o=await _.get("http://localhost:3000/auth/profile",{headers:{Authorization:`Bearer ${s}`}});if(o.data){const n=o.data;B({lastName:n.lastName||"",firstName:n.firstName||"",middleInitial:n.middleInitial||"",address:n.address||"",phoneNumber:n.phoneNumber||n.contactNumber||""}),console.log("User data fetched successfully:",n)}}catch(s){console.error("Error fetching user data:",s)}finally{S(!1)}})()},[]),l.useEffect(()=>{m&&G()},[m]);const G=async()=>{try{C(!0);const t=m.toISOString().split("T")[0],s=await y.fetchAvailableSlots(t);I(s)}catch(t){console.error("Error fetching available slots:",t),I(A())}finally{C(!1)}},T=t=>{$(t),w(!1),t&&p({...a,lastName:c.lastName,firstName:c.firstName,middleInitial:c.middleInitial||"",address:c.address,phoneNumber:c.phoneNumber})},A=()=>{const t=[];let s=8,o=0;for(;s<17;){let n=`${s===12?12:s%12}:${o===0?"00":"30"} ${s<12?"AM":"PM"}`;o+=30,o===60&&(o=0,s+=1);let r=`${s===12?12:s%12}:${o===0?"00":"30"} ${s<12?"AM":"PM"}`;t.push(`${n} - ${r}`)}return t},L=D.length>0?D:A(),d=t=>{p({...a,[t.target.name]:t.target.value}),i[t.target.name]&&u({...i,[t.target.name]:null})},P=t=>{const s=t.target.value;/^\d*$/.test(s)&&s.length<=11&&(p({...a,phoneNumber:s}),i.phoneNumber&&u({...i,phoneNumber:null}))},R=t=>{t.getDay()===0||t.getDay()===6?v(!0):(v(!1),M(t),p({...a,date:t.toLocaleDateString()}),i.date&&u({...i,date:null}))},W=async()=>{var s,o;let t={};if(Object.keys(a).forEach(n=>{!a[n]&&n!=="middleInitial"&&(t[n]="This field is required.")}),Object.keys(t).length>0){u(t);return}try{j(!0);const n={firstName:a.firstName,lastName:a.lastName,middleInitial:a.middleInitial||"",address:a.address,phoneNumber:a.phoneNumber,reasonOfVisit:a.reason,appointmentDate:m.toISOString().split("T")[0],appointmentTime:a.time,isGuest:!O};console.log("Submitting appointment data to backend:",n);const r=await y.createAppointment(n);console.log("Appointment created successfully:",r);const N={id:r.appointmentNumber||`APPT-${Date.now()}`,appointmentNumber:r.appointmentNumber,type:a.reason,date:m.toISOString().split("T")[0],time:a.time,lastName:a.lastName,firstName:a.firstName,middleInitial:a.middleInitial,address:a.address,phoneNumber:a.phoneNumber,reasonOfVisit:a.reason,appointmentDate:m.toISOString().split("T")[0],appointmentTime:a.time,status:r.status||"pending",dbId:r.id,createdAt:r.createdAt,updatedAt:r.updatedAt};V(N),alert("Appointment Confirmed!"),F(`/QRCodeAppointment/${N.appointmentNumber||N.id}`,{state:{appointment:N}}),p({lastName:"",firstName:"",middleInitial:"",address:"",phoneNumber:"",reason:"",date:"",time:""})}catch(n){console.error("Error creating appointment:",n);let r="Failed to create appointment. Please try again.";(o=(s=n.response)==null?void 0:s.data)!=null&&o.message?r=n.response.data.message:n.message&&(r=n.message),alert(r)}finally{j(!1)}};return e.jsxs("div",{className:"AppointmentFormsContainer",children:[g&&e.jsx("div",{className:"DialogOverlay",children:e.jsxs("div",{className:"DialogBox",children:[f&&e.jsx("button",{className:"DialogBackButton",onClick:f,children:"X"}),e.jsx("h3",{className:"DialogText",children:"Who is this appointment for?"}),e.jsxs("div",{className:"DialogButtons",children:[e.jsx("button",{className:"DialogButton SelfButton",onClick:()=>T(!0),disabled:b,children:b?"Loading your data...":"For Myself"}),e.jsx("button",{className:"DialogButton OtherButton",onClick:()=>T(!1),children:"For Someone Else"})]})]})}),!g&&e.jsxs("div",{className:"AppointmentFContainer",children:[e.jsx("h2",{className:"AppointmentTitle",children:"APPOINTMENT FORM"}),e.jsxs("div",{className:"FormGroup RowGroup",children:[e.jsxs("div",{className:"InputWrapper",children:[e.jsx("label",{children:"Last Name"}),e.jsx("input",{type:"text",name:"lastName",value:a.lastName,onChange:d}),i.lastName&&e.jsx("span",{className:"ErrorText",children:i.lastName})]}),e.jsxs("div",{className:"InputWrapper",children:[e.jsx("label",{children:"First Name"}),e.jsx("input",{type:"text",name:"firstName",value:a.firstName,onChange:d}),i.firstName&&e.jsx("span",{className:"ErrorText",children:i.firstName})]}),e.jsxs("div",{className:"InputWrapper SmallInput",children:[e.jsx("label",{children:"Middle Initial"}),e.jsx("input",{type:"text",name:"middleInitial",value:a.middleInitial,onChange:d,maxLength:"1"})]})]}),e.jsxs("div",{className:"FormGroup RowGroup",children:[e.jsxs("div",{className:"InputWrapper LargeInput",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",name:"address",value:a.address,onChange:d}),i.address&&e.jsx("span",{className:"ErrorText",children:i.address})]}),e.jsxs("div",{className:"InputWrapper",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"text",name:"phoneNumber",value:a.phoneNumber,onChange:P,maxLength:"11",placeholder:"e.g. 09123456789"}),i.phoneNumber&&e.jsx("span",{className:"ErrorText",children:i.phoneNumber})]})]}),e.jsxs("div",{className:"FormGroup SlotGroup",children:[e.jsxs("div",{className:"InputWrapper AppointTime",children:[e.jsx("label",{children:"Reason for Visit"}),e.jsxs("select",{name:"reason",value:a.reason,onChange:d,children:[e.jsx("option",{value:"",children:"Select a Reason"}),e.jsx("option",{value:"Birth Certificate",children:"Birth Certificate"}),e.jsx("option",{value:"Marriage Certificate",children:"Marriage Certificate"}),e.jsx("option",{value:"Death Certificate",children:"Death Certificate"})]}),i.reason&&e.jsx("span",{className:"ErrorText",children:i.reason})]}),e.jsxs("div",{className:"InputWrapper AppointTime",children:[e.jsx("label",{className:"AppointTimeSelected",children:"Select Time"}),e.jsxs("select",{name:"time",value:a.time,onChange:d,disabled:h,children:[e.jsx("option",{value:"",children:h?"Loading available times...":"Select a Time Slot"}),L.map((t,s)=>e.jsx("option",{value:t,children:t},s))]}),i.time&&e.jsx("span",{className:"ErrorText",children:i.time}),h&&e.jsx("span",{className:"InfoText",children:"Fetching real-time availability..."})]})]}),e.jsxs("div",{className:"FormGroup RowGroup",children:[e.jsxs("div",{className:"InputWrapper",children:[e.jsx("label",{children:"Select Date of Visit"}),e.jsx(U,{className:"Calendar",onChange:R,value:m,tileDisabled:({date:t})=>t.getDay()===0||t.getDay()===6||t<new Date}),i.date&&e.jsx("span",{className:"ErrorText",children:i.date}),k&&e.jsx("span",{className:"ErrorText",children:"Office is closed on weekends."}),m&&e.jsxs("div",{className:"SelectedDateInfo",children:["Selected: ",m.toLocaleDateString()]})]}),e.jsx("div",{className:"ConfirmContainer",children:e.jsx("button",{className:"ConfirmButton",onClick:W,disabled:x||h,children:x?"Creating Appointment...":"Confirm"})})]})]})]})};z.__docgenInfo={description:"",methods:[],displayName:"AppointmentContainer"};export{z as A};
