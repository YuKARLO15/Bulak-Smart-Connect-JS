import{j as e}from"./jsx-runtime-DDq6Xgo1.js";import{r as o,e as V}from"./iframe-yBmqwlMP.js";import{D as q}from"./DataPickerAppointmentForm-uZHOOXu3.js";import{s as Y}from"./RecentAppointmentData-yblrwM7G.js";import{a as D}from"./appointmentService-Cr9JVgLu.js";import{a as _}from"./index-xsH4HHeE.js";import{u as z}from"./chunk-AYJ5UCUI-DzqhQMKT.js";const T=[{label:"Book Appointment"},{label:"Save/Screenshot Summary"},{label:"Visit Registrar Office"}],H=({onBack:A,preselectedDate:B})=>{const $=z(),[x,k]=o.useState(!0),[f,w]=o.useState(null),[j,g]=o.useState(!1),[F,S]=o.useState(!1),[d,E]=o.useState({lastName:"",firstName:"",middleInitial:"",address:"",phoneNumber:""}),[t,c]=o.useState({lastName:"",firstName:"",middleInitial:"",address:"",phoneNumber:"",reason:"",date:"",time:""}),[n,u]=o.useState({}),[p,P]=o.useState(B||null),[Q,O]=o.useState(!1),[b,v]=o.useState([]),[h,C]=o.useState(!1);o.useEffect(()=>{(async()=>{try{S(!0);const s=localStorage.getItem("token");if(!s)return;const l=await _.get("http://localhost:3000/auth/profile",{headers:{Authorization:`Bearer ${s}`}});if(l.data){const i=l.data;E({lastName:i.lastName||"",firstName:i.firstName||"",middleInitial:i.middleInitial||"",address:i.address||"",phoneNumber:i.phoneNumber||i.contactNumber||""})}}catch{}finally{S(!1)}})()},[]),o.useEffect(()=>{p&&G()},[p]);const G=async()=>{try{C(!0);const a=p.toISOString().split("T")[0],s=await D.fetchAvailableSlots(a);v(s)}catch{v(I())}finally{C(!1)}},y=a=>{w(a),k(!1),a&&c({...t,lastName:d.lastName,firstName:d.firstName,middleInitial:d.middleInitial||"",address:d.address,phoneNumber:d.phoneNumber})},I=()=>{const a=[];let s=8,l=0;for(;s<17;){let i=`${s===12?12:s%12}:${l===0?"00":"30"} ${s<12?"AM":"PM"}`;l+=30,l===60&&(l=0,s+=1);let r=`${s===12?12:s%12}:${l===0?"00":"30"} ${s<12?"AM":"PM"}`;a.push(`${i} - ${r}`)}return a},L=b.length>0?b:I(),m=a=>{c({...t,[a.target.name]:a.target.value}),n[a.target.name]&&u({...n,[a.target.name]:null})},M=a=>{const s=a.target.value;/^\d*$/.test(s)&&s.length<=11&&(c({...t,phoneNumber:s}),n.phoneNumber&&u({...n,phoneNumber:null}))},R=async()=>{var s,l;let a={};if(Object.keys(t).forEach(i=>{!t[i]&&i!=="middleInitial"&&(i==="date"&&!p?a[i]="Please select a date.":i!=="date"&&(a[i]="This field is required."))}),Object.keys(a).length>0){u(a);return}try{g(!0);const i={firstName:t.firstName,lastName:t.lastName,middleInitial:t.middleInitial||"",address:t.address,phoneNumber:t.phoneNumber,reasonOfVisit:t.reason,appointmentDate:p.toISOString().split("T")[0],appointmentTime:t.time,isGuest:!f},r=await D.createAppointment(i),N={id:r.appointmentNumber||`APPT-${Date.now()}`,appointmentNumber:r.appointmentNumber,type:t.reason,date:p.toISOString().split("T")[0],time:t.time,lastName:t.lastName,firstName:t.firstName,middleInitial:t.middleInitial,address:t.address,phoneNumber:t.phoneNumber,reasonOfVisit:t.reason,appointmentDate:p.toISOString().split("T")[0],appointmentTime:t.time,status:r.status||"pending",dbId:r.id,createdAt:r.createdAt,updatedAt:r.updatedAt};Y(N),alert("Your appointment has been confirmed!"),$(`/QRCodeAppointment/${N.appointmentNumber||N.id}`,{state:{appointment:N}}),c({lastName:"",firstName:"",middleInitial:"",address:"",phoneNumber:"",reason:"",date:"",time:""})}catch(i){let r="Failed to create appointment. Please try again.";(l=(s=i.response)==null?void 0:s.data)!=null&&l.message?r=i.response.data.message:i.message&&(r=i.message),alert(r)}finally{g(!1)}},W=e.jsxs("div",{className:"DialogBoxAppointForm",children:[A&&e.jsxs("button",{className:"DialogBackButtonAppointForm",onClick:A,"aria-label":"Go back",children:[e.jsx("span",{"aria-hidden":"true",children:"×"})," ",e.jsx("p",{className:"DialoagBackp",children:" Close"})]}),e.jsx("h3",{className:"DialogTextAppointForm",children:"Appointment for:"}),e.jsxs("div",{className:"DialogButtonsAppointForm",children:[e.jsx("button",{className:`DialogButtonAppointForm SelfButtonAppointForm${f===!0?" SelectedAppointForm":""}`,onClick:()=>y(!0),disabled:F,children:F?"Loading your data...":"Myself"}),e.jsx("button",{className:`DialogButtonAppointForm OtherButtonAppointForm${f===!1?" SelectedAppointForm":""}`,onClick:()=>y(!1),children:"Someone Else"})]})]}),U=()=>e.jsx("div",{className:"StepperContainerAppointForm",children:T.map((a,s)=>e.jsxs(V.Fragment,{children:[e.jsxs("div",{className:`StepAppointForm${s===0?" ActiveAppointForm":""}`,children:[e.jsx("div",{className:"StepCircleAppointForm",children:s+1}),e.jsx("div",{className:"StepLabelAppointForm",children:a.label})]}),s!==T.length-1&&e.jsx("div",{className:"StepLineAppointForm"})]},s))});return e.jsxs("div",{className:"AppointmentFormsContainerAppointForm ProStyledAppointForm",children:[x&&e.jsx("div",{className:"DialogOverlayAppointForm",children:W}),!x&&e.jsxs("div",{className:"AppointmentFContainerAppointForm",children:[e.jsx("div",{className:"BackButtonWrapperAppointForm",children:e.jsx("button",{className:"ActualBackButtonAppointForm",onClick:A,children:"← Back"})}),e.jsx(U,{}),e.jsx("h2",{className:"AppointmentTitleAppointForm",children:"Booking Appointment"}),e.jsxs("div",{className:"AppointmentLayoutAppointForm",children:[e.jsxs("div",{className:"AppointmentFormSectionAppointForm",children:[e.jsxs("div",{className:"FormGroupAppointForm RowGroupAppointForm",children:[e.jsxs("div",{className:"InputWrapperAppointForm",children:[e.jsx("label",{children:"Last Name"}),e.jsx("input",{type:"text",name:"lastName",value:t.lastName,onChange:m,autoComplete:"family-name"}),n.lastName&&e.jsx("span",{className:"ErrorTextAppointForm",children:n.lastName})]}),e.jsxs("div",{className:"InputWrapperAppointForm",children:[e.jsx("label",{children:"First Name"}),e.jsx("input",{type:"text",name:"firstName",value:t.firstName,onChange:m,autoComplete:"given-name"}),n.firstName&&e.jsx("span",{className:"ErrorTextAppointForm",children:n.firstName})]}),e.jsxs("div",{className:"InputWrapperAppointForm SmallInputAppointForm",children:[e.jsx("label",{children:"Middle Initial"}),e.jsx("input",{type:"text",name:"middleInitial",value:t.middleInitial,onChange:m,maxLength:"1",autoComplete:"additional-name"})]})]}),e.jsxs("div",{className:"FormGroupAppointForm RowGroupAppointForm",children:[e.jsxs("div",{className:"InputWrapperAppointForm LargeInputAppointForm",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",name:"address",value:t.address,onChange:m,autoComplete:"street-address"}),n.address&&e.jsx("span",{className:"ErrorTextAppointForm",children:n.address})]}),e.jsxs("div",{className:"InputWrapperAppointForm",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"text",name:"phoneNumber",value:t.phoneNumber,onChange:M,maxLength:"11",placeholder:"e.g. 09123456789",autoComplete:"tel"}),n.phoneNumber&&e.jsx("span",{className:"ErrorTextAppointForm",children:n.phoneNumber})]})]}),e.jsxs("div",{className:"FormGroupAppointForm SlotGroupAppointForm",children:[e.jsxs("div",{className:"InputWrapperAppointForm AppointTimeAppointForm",children:[e.jsx("label",{children:"Reason for Visit"}),e.jsxs("select",{name:"reason",value:t.reason,onChange:m,children:[e.jsx("option",{value:"",children:"Select a Reason"}),e.jsx("option",{value:"Birth Certificate",children:"Birth Certificate"}),e.jsx("option",{value:"Marriage Certificate",children:"Marriage Certificate"}),e.jsx("option",{value:"Death Certificate",children:"Death Certificate"})]}),n.reason&&e.jsx("span",{className:"ErrorTextAppointForm",children:n.reason})]}),e.jsxs("div",{className:"InputWrapperAppointForm AppointTimeAppointForm",children:[e.jsx("label",{className:"AppointTimeSelectedAppointForm",children:"Select Time"}),e.jsxs("select",{name:"time",value:t.time,onChange:m,disabled:h,children:[e.jsx("option",{value:"",children:h?"Loading available times...":"Select a Time Slot"}),L.map((a,s)=>e.jsx("option",{value:a,children:a},s))]}),n.time&&e.jsx("span",{className:"ErrorTextAppointForm",children:n.time}),h&&e.jsx("span",{className:"InfoTextAppointForm",children:"Fetching real-time availability..."})]})]}),e.jsx("div",{className:"FormGroupAppointForm RowGroupAppointForm",children:e.jsxs("div",{className:"InputWrapperAppointForm",children:[e.jsx("label",{children:"Select Date of Visit"}),e.jsx(q,{value:p,onChange:a=>{O(!1),P(a),c({...t,date:a?a.toLocaleDateString():""}),n.date&&u({...n,date:null})},error:n.date,placeholder:"Select date"})]})}),e.jsx("div",{className:"ConfirmContainerAppointForm",children:e.jsx("button",{className:"ConfirmButtonAppointForm",onClick:R,disabled:j||h,children:j?"Booking Appointment...":"Confirm Appointment"})})]}),e.jsxs("div",{className:"AppointmentSummaryPanelAppointForm",children:[e.jsx("h4",{className:"SummaryTitleAppointForm",children:"How to Book Your Appointment"}),e.jsxs("ol",{className:"SummaryStepsAppointForm",children:[e.jsx("li",{children:"Book appointment by filling in your details on this page."}),e.jsx("li",{children:"Screenshot or save your appointment summary after confirmation."}),e.jsx("li",{children:"Go to the Municipal Civil Registrar's Office on your chosen date and time. Please bring your appointment summary and required documents."})]}),e.jsxs("div",{className:"SummaryNoteAppointForm",children:[e.jsx("strong",{children:"Note:"})," If you do not arrive within 15 minutes of your scheduled time, your appointment may be rescheduled."]})]})]})]})]})};H.__docgenInfo={description:"",methods:[],displayName:"AppointmentContainer"};export{H as A};
